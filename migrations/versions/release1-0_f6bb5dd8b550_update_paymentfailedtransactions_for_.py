"""Update PaymentFailedTransactions for celery

Revision ID: f6bb5dd8b550
Revises: 0bebaad7e4a1
Create Date: 2021-09-24 13:53:30.929501

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = 'f6bb5dd8b550'
down_revision = '0bebaad7e4a1'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.alter_column('ClientInfo', 'street',
               existing_type=sa.VARCHAR(length=50),
               type_=sa.String(length=70),
               existing_nullable=True)
    op.alter_column('ClientInfo', 'city',
               existing_type=sa.VARCHAR(length=50),
               type_=sa.String(length=35),
               existing_nullable=True)
    op.add_column('PaymentFailedTransactions', sa.Column('payment_method_id', sa.Integer(), nullable=True))
    op.add_column('PaymentFailedTransactions', sa.Column('booking_id', sa.Integer(), nullable=True))
    op.add_column('PaymentFailedTransactions', sa.Column('retries', sa.Integer(), nullable=True))
    op.create_foreign_key(None, 'PaymentFailedTransactions', 'PaymentMethods', ['payment_method_id'], ['idx'], ondelete='SET NULL')
    op.create_foreign_key(None, 'PaymentFailedTransactions', 'TelehealthBookings', ['booking_id'], ['idx'], ondelete='SET NULL')
    op.drop_column('PaymentFailedTransactions', 'transaction_id')
    op.add_column('TelehealthBookings', sa.Column('charged', sa.Boolean(), nullable=True))
    op.drop_column('TelehealthBookings', 'is_paid')
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('TelehealthBookings', sa.Column('is_paid', sa.BOOLEAN(), autoincrement=False, nullable=True))
    op.drop_column('TelehealthBookings', 'charged')
    op.add_column('PaymentFailedTransactions', sa.Column('transaction_id', sa.VARCHAR(), autoincrement=False, nullable=True))
    op.drop_constraint(None, 'PaymentFailedTransactions', type_='foreignkey')
    op.drop_constraint(None, 'PaymentFailedTransactions', type_='foreignkey')
    op.drop_column('PaymentFailedTransactions', 'retries')
    op.drop_column('PaymentFailedTransactions', 'booking_id')
    op.drop_column('PaymentFailedTransactions', 'payment_method_id')
    op.alter_column('ClientInfo', 'city',
               existing_type=sa.String(length=35),
               type_=sa.VARCHAR(length=50),
               existing_nullable=True)
    op.alter_column('ClientInfo', 'street',
               existing_type=sa.String(length=70),
               type_=sa.VARCHAR(length=50),
               existing_nullable=True)
    # ### end Alembic commands ###
