"""Add proper relationships to Wearables.

Revision ID: abea48a1a2c2
Revises: 1906eae3b2f0
Create Date: 2021-04-26 11:00:38.133487

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = 'abea48a1a2c2'
down_revision = '1906eae3b2f0'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('Wearables', sa.Column(
        'registered_freestyle',
        sa.Boolean(),
        server_default='f',
         nullable=True))
    op.alter_column('Wearables', 'registered_freestyle',
        existing_type=sa.BOOLEAN(),
        nullable=False)
    op.create_unique_constraint(None, 'Wearables', ['user_id'])
    op.add_column('WearablesFitbit', sa.Column('wearable_id', sa.Integer(), nullable=False))
    op.alter_column('WearablesFitbit', 'access_token',
               existing_type=sa.VARCHAR(length=512),
               type_=sa.String(length=1048),
               existing_nullable=True)
    op.create_unique_constraint(None, 'WearablesFitbit', ['wearable_id'])
    op.create_unique_constraint(None, 'WearablesFitbit', ['user_id'])
    op.create_foreign_key(None, 'WearablesFitbit', 'Wearables', ['wearable_id'], ['idx'], ondelete='CASCADE')
    op.add_column('WearablesFreeStyle', sa.Column('wearable_id', sa.Integer(), nullable=False))
    op.create_unique_constraint(None, 'WearablesFreeStyle', ['user_id'])
    op.create_unique_constraint(None, 'WearablesFreeStyle', ['wearable_id'])
    op.create_foreign_key(None, 'WearablesFreeStyle', 'Wearables', ['wearable_id'], ['idx'], ondelete='CASCADE')
    op.add_column('WearablesOura', sa.Column('wearable_id', sa.Integer(), nullable=False))
    op.create_unique_constraint(None, 'WearablesOura', ['user_id'])
    op.create_unique_constraint(None, 'WearablesOura', ['wearable_id'])
    op.create_foreign_key(None, 'WearablesOura', 'Wearables', ['wearable_id'], ['idx'], ondelete='CASCADE')
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint("WearablesOura_wearable_id_fkey", 'WearablesOura', type_='foreignkey')
    op.drop_constraint("WearablesOura_wearable_id_key", 'WearablesOura', type_='unique')
    op.drop_constraint("WearablesOura_user_id_key", 'WearablesOura', type_='unique')
    op.drop_column('WearablesOura', 'wearable_id')
    op.drop_constraint("WearablesFreeStyle_wearable_id_fkey", 'WearablesFreeStyle', type_='foreignkey')
    op.drop_constraint("WearablesFreeStyle_wearable_id_key", 'WearablesFreeStyle', type_='unique')
    op.drop_constraint("WearablesFreeStyle_user_id_key", 'WearablesFreeStyle', type_='unique')
    op.drop_column('WearablesFreeStyle', 'wearable_id')
    op.drop_constraint("WearablesFitbit_wearable_id_fkey", 'WearablesFitbit', type_='foreignkey')
    op.drop_constraint("WearablesFitbit_wearable_id_key", 'WearablesFitbit', type_='unique')
    op.drop_constraint("WearablesFitbit_user_id_key", 'WearablesFitbit', type_='unique')
    op.alter_column('WearablesFitbit', 'access_token',
               existing_type=sa.String(length=1048),
               type_=sa.VARCHAR(length=512),
               existing_nullable=True)
    op.drop_column('WearablesFitbit', 'wearable_id')
    op.drop_constraint("Wearables_user_id_key", 'Wearables', type_='unique')
    op.drop_column('Wearables', 'registered_freestyle')
    # ### end Alembic commands ###
